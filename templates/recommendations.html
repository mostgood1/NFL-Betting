<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFL Betting – Recommendations</title>
  <style>
    :root{
      --bg:#080d1a; --card:#0d1426; --card2:#121b31; --text:#f5f7ff; --muted:#c3cee4; --border:#243356;
      --link:#b8d1ff; --pill-bg:#101a2e; --pill-br:#2a3a63; --badge-bg:#162247; --badge-br:#2a3a63;
    }
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    a{color:var(--link)}
    .card{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th, td{padding:8px}
    thead th{text-align:left;border-bottom:1px solid var(--border)}
    tbody tr{border-top:1px solid var(--border)}
  .res{display:inline-block;padding:2px 6px;border-radius:6px;border:1px solid var(--border)}
  .res-win{border-color:#2e8b57;color:#9ae6b4}
  .res-loss{border-color:#8b2e2e;color:#fca5a5}
  .res-push{border-color:#2a3a63;color:#c3cee4}
  .pill{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;border:1px solid var(--pill-br);background:var(--pill-bg);font-size:12px}
  .pill-low{color:#fde68a;border-color:#854d0e}
  .pill-medium{color:#93c5fd;border-color:#1e3a8a}
  .pill-high{color:#9ae6b4;border-color:#2e8b57}
  .cards-summary{display:flex;flex-wrap:wrap;gap:12px;margin:12px 0;align-items:stretch}
  .card-summary{flex:1;min-width:240px;padding:10px;background:linear-gradient(180deg,#132a52,#0d1426)}
  .card-tier{flex:1;min-width:200px;padding:10px}
  .filters{margin:8px 0;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .ml-8{margin-left:8px}
  .mt-4{margin-top:4px}
  .mt-1{margin-top:1rem}
  .tar{text-align:right}
  .title-sm{font-size:14px;letter-spacing:.5px;text-transform:uppercase;color:var(--muted)}
  .title-lg{font-size:20px;font-weight:600}
  .title-md{font-size:18px;font-weight:600}
  .muted-small{font-size:12px;color:var(--muted)}
  .muted-tiny{font-size:11px;color:var(--muted)}
  .table-wrap{overflow-x:auto}
  .lh-13{line-height:1.3}
  /* --- Mobile Enhancements --- */
  @media (max-width:760px){
    .container{padding:0 10px;margin:12px auto}
    h1{font-size:20px;margin-bottom:6px}
  .nav{font-size:12px;overflow-x:auto;white-space:nowrap;padding-bottom:4px}
    .nav a{display:inline-block;margin-right:6px}
    table{font-size:12px}
    th,td{padding:6px 4px}
    thead th{font-size:11px}
    .card{padding:10px}
    form label{font-size:12px}
    form input, form select{padding:4px 6px;font-size:12px}
    form button{padding:4px 8px;font-size:12px}
    .pill{font-size:10px;padding:2px 6px;margin-left:4px}
  }
  </style>
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://a.espncdn.com">
  <link rel="dns-prefetch" href="https://a.espncdn.com">
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="EV-based betting recommendations for NFL games." />
</head>
<body>
  <div class="container">
  <div class="nav"><a href="/">Cards</a> | <a href="/recommendations">Recommendations</a> | <a href="/props">Props</a> | <a href="/props/recommendations">Props Recs</a> | <a href="/reconciliation">Reconciliation</a> | <a href="/roster-validation{% if season or week %}?{% if season %}season={{ season }}{% endif %}{% if season and week %}&{% endif %}{% if week %}week={{ week }}{% endif %}{% endif %}" target="_blank">Roster Validation</a> | <a href="/api/predictions" target="_blank">API</a> | <a href="/health" target="_blank">Health</a> | <button type="button" class="theme-toggle" id="themeToggle" title="Toggle light/dark">Toggle Theme</button></div>
  <h1>NFL Betting – Recommendations</h1>
  {% if accuracy %}
  <div class="cards-summary">
    {% set overall = accuracy.get('Overall') %}
    {% if overall %}
      <div class="card card-summary">
        <div class="title-sm">Overall</div>
        <div class="mt-4 title-lg">
          {% if overall.accuracy_pct is not none %}{{ '%.1f' % overall.accuracy_pct }}% Accuracy{% else %}—{% endif %}
        </div>
        <div class="muted-small mt-4">
          {{ overall.wins }}W-{{ overall.losses }}L{% if overall.pushes %}-{{ overall.pushes }}P{% endif %} / {{ overall.resolved }} settled
        </div>
        <div class="mt-4 muted-small">ROI: {% if overall.roi_pct is not none %}{{ '%.1f' % overall.roi_pct }}%{% else %}—{% endif %}</div>
        <div class="mt-4 muted-tiny">Stake: ${{ '%.0f' % overall.stake_total }} | P/L: ${{ '%.0f' % overall.profit_total }}</div>
        <div class="mt-4 muted-tiny">Total picks: {{ overall.total }}</div>
      </div>
    {% endif %}
    {% for tier in ['High','Medium','Low'] %}
      {% set m = accuracy.get(tier) %}
      <div class="card card-tier">
        <div class="title-sm">{{ tier }}</div>
        <div class="mt-4 title-md">
          {% if m.accuracy_pct is not none %}{{ '%.1f' % m.accuracy_pct }}% Acc{% else %}—{% endif %}
        </div>
        <div class="muted-small mt-4">
          {{ m.wins }}W-{{ m.losses }}L{% if m.pushes %}-{{ m.pushes }}P{% endif %} / {{ m.resolved }}
        </div>
        <div class="mt-4 muted-small">ROI: {% if m.roi_pct is not none %}{{ '%.1f' % m.roi_pct }}%{% else %}—{% endif %}</div>
        <div class="mt-4 muted-tiny">Stake: ${{ '%.0f' % m.stake_total }} | P/L: ${{ '%.0f' % m.profit_total }}</div>
        <div class="mt-4 muted-tiny">Picks: {{ m.total }}</div>
      </div>
    {% endfor %}
  </div>
  {% endif %}
  <p class="muted muted-small mt-4 lh-13">Sorted by confidence then EV. Odds assumed -110 for spread/total when book odds are not present.</p>
  <form method="get" action="/recommendations" class="filters">
    <label>Week: <input type="number" name="week" value="{{ week or '' }}" class="week-input" /></label>
    <label>Sort by: 
      <select name="sort">
        <option value="" {% if not sort %}selected{% endif %}>Confidence (default)</option>
        <option value="time" {% if sort=='time' %}selected{% endif %}>Game time</option>
        <option value="type" {% if sort=='type' %}selected{% endif %}>Bet type</option>
        <option value="odds" {% if sort=='odds' %}selected{% endif %}>Odds</option>
        <option value="ev" {% if sort=='ev' %}selected{% endif %}>EV</option>
        <option value="level" {% if sort=='level' %}selected{% endif %}>Recommendation level</option>
      </select>
    </label>
    <button type="submit">Apply</button>
    <a href="/recommendations" class="ml-8">Reset</a>
  </form>

    {% if not have_data %}
      <div class="card">No recommendations available.</div>
    {% else %}
  {% for tier in ["High", "Medium", "Low"] %}
        {% set items = groups.get(tier, []) %}
        {% if items and items|length > 0 %}
          <h2 class="mt-1">{{ tier }} confidence</h2>
          <div class="table table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Game</th>
                  <th>Type</th>
                  <th>Selection</th>
                  <th class="tar">Odds</th>
                  <th class="tar">EV</th>
                  <th>Result</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                {% for r in items %}
                <tr>
                  <td>{{ r.away_team }} @ {{ r.home_team }}</td>
                  <td>{{ r.type }}</td>
                  <td>
                    {{ r.selection }}
                    {% if r.confidence %}
                      <span class="pill {% if r.confidence=='High' %}pill-high{% elif r.confidence=='Medium' %}pill-medium{% else %}pill-low{% endif %}">{{ r.confidence }}</span>
                    {% endif %}
                  </td>
                  <td class="tar">{{ r.odds }}</td>
                  <td class="tar">{{ '%.1f%%' % r.ev_pct if r.ev_pct is not none }}</td>
                  <td>
                    {% if r.result %}
                      <span class="res {% if r.result=='Win' %}res-win{% elif r.result=='Loss' %}res-loss{% else %}res-push{% endif %}">{{ r.result }}</span>
                    {% else %}
                      —
                    {% endif %}
                  </td>
                  <td>{{ r.game_date }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% endif %}
      {% endfor %}
      {# Show untiered items (confidence is None/"") under an 'Other' bucket #}
      {% set others = groups.get("", []) %}
      {% if others and others|length > 0 %}
        <h2 class="mt-1">Other</h2>
        <div class="table table-wrap">
          <table>
            <thead>
              <tr>
                <th>Game</th>
                <th>Type</th>
                <th>Selection</th>
                <th class="tar">Odds</th>
                <th class="tar">EV</th>
                <th>Result</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {% for r in others %}
              <tr>
                <td>{{ r.away_team }} @ {{ r.home_team }}</td>
                <td>{{ r.type }}</td>
                <td>
                  {{ r.selection }}
                  {% if r.confidence %}
                    <span class="pill {% if r.confidence=='High' %}pill-high{% elif r.confidence=='Medium' %}pill-medium{% else %}pill-low{% endif %}">{{ r.confidence }}</span>
                  {% endif %}
                </td>
                <td class="tar">{{ r.odds }}</td>
                <td class="tar">{{ '%.1f%%' % r.ev_pct if r.ev_pct is not none }}</td>
                <td>
                  {% if r.result %}
                    <span class="res {% if r.result=='Win' %}res-win{% elif r.result=='Loss' %}res-loss{% else %}res-push{% endif %}">{{ r.result }}</span>
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td>{{ r.game_date }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    {% endif %}
  </div>
  <script>
    (function(){
      try{
        var body = document.body;
        var saved = localStorage.getItem('theme');
        if (saved === 'light') { body.classList.add('light'); }
        var tbtn = document.getElementById('themeToggle');
        if (tbtn) {
          tbtn.addEventListener('click', function(){
            body.classList.toggle('light');
            localStorage.setItem('theme', body.classList.contains('light') ? 'light' : 'dark');
          });
        }
      } catch(e){}
    })();
  </script>
</body>
</html>
